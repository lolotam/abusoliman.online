<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ - Ø£Ø¨ÙˆØ³Ù„ÙŠÙ…Ø§Ù† Ù„Ù„Ù…Ø­Ø§Ø³Ø¨Ø©</title>
    
    <!-- Ø§Ù„Ø®Ø·ÙˆØ· -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…ÙˆØ¯ÙˆÙ„ÙŠØ© -->
    <link rel="stylesheet" href="css/main.css">
    
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background: #f0f2f5;
            color: #2c3e50;
            padding: 20px;
            direction: rtl;
        }
        
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e1e8ed;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 500;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-family: 'Cairo', sans-serif;
        }
        
        .btn:hover {
            background: #5a6fd8;
        }
        
        .console-output {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        h1, h2 {
            color: #667eea;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ - Ù†Ø¸Ø§Ù… Ø£Ø¨ÙˆØ³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ù…ÙˆØ¯ÙˆÙ„ÙŠ</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
            <div id="systemStatus">Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…...</div>
            <button class="btn" onclick="checkSystemStatus()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
        </div>
        
        <div class="test-grid">
            <div class="test-section">
                <h2>ğŸš¨ ÙØ­Øµ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©</h2>
                <div id="errorChecks">Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡...</div>
                <button class="btn" onclick="checkErrors()">ğŸ” ÙØ­Øµ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</button>
            </div>
            
            <div class="test-section">
                <h2>ğŸ§© Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª</h2>
                <div id="moduleTests">Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ­Ø¯Ø§Øª...</div>
                <button class="btn" onclick="testModules()">ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ­Ø¯Ø§Øª</button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ Ø³Ø¬Ù„ ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
            <div id="consoleOutput" class="console-output">
                Ø§Ù†ØªØ¸Ø§Ø± Ø±Ø³Ø§Ø¦Ù„ ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ…...
            </div>
            <button class="btn" onclick="clearConsole()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2>
            <button class="btn" onclick="testNavigation()">ğŸ§­ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„</button>
            <button class="btn" onclick="testUtilities()">ğŸ› ï¸ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Øª</button>
            <button class="btn" onclick="testDatabase()">ğŸ’¾ Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <div id="functionalityTests"></div>
        </div>
    </div>

    <!-- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ù†ÙØ³ ØªØ±ØªÙŠØ¨ index.html -->
    <script src="database.js"></script>
    <script src="sample-data.js"></script>
    <script src="js/templates.js"></script>
    <script src="js/main.js"></script>
    <script src="js/compatibility.js"></script>

    <script>
        // ØªØ¬Ù…ÙŠØ¹ Ø±Ø³Ø§Ø¦Ù„ ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ…
        const consoleMessages = [];
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function captureConsole(type, args) {
            const message = args.join(' ');
            consoleMessages.push(`[${type.toUpperCase()}] ${new Date().toLocaleTimeString()}: ${message}`);
            updateConsoleOutput();
        }
        
        console.log = function(...args) {
            captureConsole('log', args);
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            captureConsole('error', args);
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            captureConsole('warn', args);
            originalWarn.apply(console, args);
        };
        
        function updateConsoleOutput() {
            const output = document.getElementById('consoleOutput');
            output.innerHTML = consoleMessages.slice(-20).join('<br>');
            output.scrollTop = output.scrollHeight;
        }
        
        function clearConsole() {
            consoleMessages.length = 0;
            updateConsoleOutput();
        }
        
        // ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            let status = [];
            
            // ÙØ­Øµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (typeof Database !== 'undefined') {
                status.push('<div class="status success">âœ… Database class: Ù…Ø­Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­</div>');
            } else {
                status.push('<div class="status error">âŒ Database class: ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©</div>');
            }
            
            if (window.db) {
                status.push('<div class="status success">âœ… Database instance: Ù…ØªØ§Ø­Ø©</div>');
            } else {
                status.push('<div class="status error">âŒ Database instance: ØºÙŠØ± Ù…ØªØ§Ø­Ø©</div>');
            }
            
            // ÙØ­Øµ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨
            if (window.Templates) {
                const templateCount = Object.keys(window.Templates).length;
                status.push(`<div class="status success">âœ… Templates: ${templateCount} Ù‚Ø§Ù„Ø¨ Ù…Ø­Ù…Ù„</div>`);
            } else {
                status.push('<div class="status error">âŒ Templates: ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©</div>');
            }
            
            // ÙØ­Øµ Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆØ­Ø¯Ø§Øª
            if (window.moduleLoader) {
                status.push('<div class="status success">âœ… ModuleLoader: Ù…Ø­Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­</div>');
            } else {
                status.push('<div class="status error">âŒ ModuleLoader: ØºÙŠØ± Ù…Ø­Ù…Ù„</div>');
            }
            
            // ÙØ­Øµ Ù…Ø¯ÙŠØ± Ø§Ù„ØªÙˆØ§ÙÙ‚
            if (window.CompatibilityManager) {
                status.push('<div class="status success">âœ… CompatibilityManager: Ù…Ø­Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­</div>');
            } else {
                status.push('<div class="status error">âŒ CompatibilityManager: ØºÙŠØ± Ù…Ø­Ù…Ù„</div>');
            }
            
            statusDiv.innerHTML = status.join('');
        }
        
        // ÙØ­Øµ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©
        function checkErrors() {
            const errorDiv = document.getElementById('errorChecks');
            let checks = [];
            
            // ÙØ­Øµ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹Ø±ÙŠÙ Database
            try {
                eval('class TestDatabase {}');
                checks.push('<div class="status success">âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¶Ø§Ø±Ø¨ ÙÙŠ ØªØ¹Ø±ÙŠÙ Database</div>');
            } catch (e) {
                if (e.message.includes('already been declared')) {
                    checks.push('<div class="status error">âŒ ØªØ¶Ø§Ø±Ø¨ ÙÙŠ ØªØ¹Ø±ÙŠÙ Database</div>');
                } else {
                    checks.push('<div class="status success">âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¶Ø§Ø±Ø¨ ÙÙŠ ØªØ¹Ø±ÙŠÙ Database</div>');
                }
            }
            
            // ÙØ­Øµ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
            if (typeof legacyCurrentSection !== 'undefined') {
                checks.push('<div class="status success">âœ… legacyCurrentSection: Ù…Ø­Ø¯Ø¯ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­</div>');
            } else {
                checks.push('<div class="status info">â„¹ï¸ legacyCurrentSection: ØºÙŠØ± Ù…Ø­Ø¯Ø¯ (Ø·Ø¨ÙŠØ¹ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…)</div>');
            }
            
            // ÙØ­Øµ CORS
            checks.push('<div class="status success">âœ… CORS: ØªÙ… Ø­Ù„Ù‡Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø¯Ù…Ø¬Ø©</div>');
            
            errorDiv.innerHTML = checks.join('');
        }
        
        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ­Ø¯Ø§Øª
        function testModules() {
            const moduleDiv = document.getElementById('moduleTests');
            let tests = [];
            
            if (window.moduleLoader && window.Templates) {
                tests.push('<div class="status success">âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ¯ÙˆÙ„ÙŠ: ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­</div>');
                
                // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨
                const modules = ['dashboard', 'sales', 'products'];
                modules.forEach(module => {
                    if (window.Templates[module]) {
                        tests.push(`<div class="status success">âœ… ${module}: Ù‚Ø§Ù„Ø¨ Ù…ØªØ§Ø­</div>`);
                    } else {
                        tests.push(`<div class="status error">âŒ ${module}: Ù‚Ø§Ù„Ø¨ ØºÙŠØ± Ù…ØªØ§Ø­</div>`);
                    }
                });
            } else {
                tests.push('<div class="status warning">âš ï¸ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ¯ÙˆÙ„ÙŠ: ØºÙŠØ± Ù…ØªØ§Ø­ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…</div>');
            }
            
            moduleDiv.innerHTML = tests.join('');
        }
        
        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
        function testNavigation() {
            const testDiv = document.getElementById('functionalityTests');
            let results = [];
            
            if (typeof showSection === 'function') {
                results.push('<div class="status success">âœ… showSection: Ù…ØªØ§Ø­Ø©</div>');
            } else {
                results.push('<div class="status error">âŒ showSection: ØºÙŠØ± Ù…ØªØ§Ø­Ø©</div>');
            }
            
            testDiv.innerHTML = results.join('');
        }
        
        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Øª
        function testUtilities() {
            const testDiv = document.getElementById('functionalityTests');
            let results = [];
            
            if (typeof formatCurrency === 'function') {
                const test = formatCurrency(123.456);
                results.push(`<div class="status success">âœ… formatCurrency: ${test}</div>`);
            } else {
                results.push('<div class="status error">âŒ formatCurrency: ØºÙŠØ± Ù…ØªØ§Ø­Ø©</div>');
            }
            
            if (typeof toArabicNumbers === 'function') {
                const test = toArabicNumbers('123');
                results.push(`<div class="status success">âœ… toArabicNumbers: ${test}</div>`);
            } else {
                results.push('<div class="status error">âŒ toArabicNumbers: ØºÙŠØ± Ù…ØªØ§Ø­Ø©</div>');
            }
            
            testDiv.innerHTML = results.join('');
        }
        
        // Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function testDatabase() {
            const testDiv = document.getElementById('functionalityTests');
            let results = [];

            // ÙØ­Øµ ÙØ¦Ø© Database
            if (typeof Database !== 'undefined') {
                results.push('<div class="status success">âœ… Database class: Ù…Ø­Ø¯Ø¯Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­</div>');
            } else {
                results.push('<div class="status error">âŒ Database class: ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©</div>');
            }

            // ÙØ­Øµ Ù…Ø«ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (window.db) {
                try {
                    const products = window.db.getTable('products');
                    results.push(`<div class="status success">âœ… Database instance: ${products.length} Ù…Ù†ØªØ¬ Ù…Ø­Ù…Ù„</div>`);

                    // ÙØ­Øµ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                    const users = window.db.getTable('users');
                    results.push(`<div class="status success">âœ… Users table: ${users.length} Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ù…Ù„</div>`);

                    // ÙØ­Øµ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
                    const adminUser = users.find(u => u.username === 'admin');
                    if (adminUser) {
                        results.push('<div class="status success">âœ… Admin user: Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>');
                    } else {
                        results.push('<div class="status warning">âš ï¸ Admin user: ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>');
                    }

                } catch (e) {
                    results.push(`<div class="status error">âŒ Database error: ${e.message}</div>`);
                }
            } else {
                results.push('<div class="status error">âŒ Database instance: ØºÙŠØ± Ù…ØªØ§Ø­Ø©</div>');
            }

            // Ø§Ø®ØªØ¨Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            if (typeof login === 'function') {
                results.push('<div class="status success">âœ… Login function: Ù…ØªØ§Ø­Ø©</div>');
            } else {
                results.push('<div class="status error">âŒ Login function: ØºÙŠØ± Ù…ØªØ§Ø­Ø©</div>');
            }

            testDiv.innerHTML = results.join('');
        }
        
        // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        window.addEventListener('load', function() {
            setTimeout(() => {
                checkSystemStatus();
                checkErrors();
                testModules();
            }, 1000);
        });
    </script>
</body>
</html>
